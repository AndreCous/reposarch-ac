const places = {
    'type': 'FeatureCollection',
    'features': [
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': '<h2>Circular fortresses from the Viking Age</h2> <p>Significance: cultural properties</p> <p>Country: Denmark</p><p>Criterion: (iii)(iv)</p><p>Property: 51 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [9.25468, 56.99523]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': '<h2>Ancient Jericho/Tell es-Sultan</h2> <p>Significance: cultural properties</p> <p>Country: State of Palestine</p><p>Criterion: (iii)(iv)</p><p>Property: 5.93 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [35.26386, 31.52167]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': '<h2>Hopewell Ceremonial Earthworks</h2> <p>Significance: cultural properties</p> <p>Country: United States of America</p><p>Criterion: (i)(iii)</p><p>Property: 320.7 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [-82.264582, 40.31317]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': '<h2>ESMA Museum and Place of Memory - Former clandestine center of detention, torture and extermination</h2> <p>Significance: cultural properties</p> <p>Country: Argentina</p><p>Criterion: (vi)</p><p>Property: 0.907 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [-58.27552, -34.321191]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>Gordion</h2> <p>Significance: cultural properties</p> <p>Country: Turkey</p><p>Criterion: (iii)</p><p>Property: 1,064 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [31.5910, 39.3836]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>Kaunas, modernist city: an architecure of optimism, 1919-1939</h2> <p>Significance: cultural properties</p> <p>Country: Lithuania</p><p>Criterion: (iv)</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [23.5545, 54.5349]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>Koh Ker: archaeological site of ancient Lingpura or Chok Gargyar</h2> <p>Significance: cultural properties</p> <p>Country: Cambodia</p><p>Criterion: (ii)(iv)</p><p>Property: 1,187.61 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [104.3214, 13.4659]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>The Persian caravanseri</h2> <p>Significance: cultural properties</p> <p>Country: Iran</p><p>Criterion: (ii)(iii)</p><p>Property: 30.34 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [51.251249, 35.33007]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>The cultural landscape of Gedeo country</h2> <p>Significance: cultural properties</p><p>Country: Ethiopia</p><p>Criterion: (iii)(v)</p><p>Property: 29,620 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [38.1716, 6.1456]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>Deer Stone Monuments and Associated Bronze Age Sites</h2>  <p>Significance: cultural properties</p><p>Country: Mongolia</p><p>Criterion: (i)(iii)</p><p>Property: 9,768.03 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [101.1333, 47.4434]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>Santiniketan</h2> <p>Significance: cultural properties</p><p>Country: India</p><p>Criterion: (iv)(vi)</p><p>Property: 36 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [87.4159, 23.4049]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>Gaya Tumuli</h2> <p>Significance: cultural properties</p><p>Country: Republic of Korea</p><p>Criterion: (iii)</p><p>Property: 189 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [128.522541, 35.141415]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>Old Town of Kuldīga</h2> <p>Significance: cultural properties</p><p>Country: Latvia</p><p>Criterion: (v)</p><p>Property: 84.33 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [21.58175, 56.5839]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': 
                '<h2>Žatec and the Landscape of Saaz Hops</h2> <p>Significance: cultural properties</p><p>Country: Czechia</p><p>Criterion: (iii)(iv)(v)</p><p>Property: 593.97 ha</p><p>Property: 593.97 ha</p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [13.3712, 50.1913]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': "<h2>Tak'alik Ab'aj National Archaeological Park</h2> <p>Significance: cultural properties</p> <p>Country: Guatemala</p><p>Criterion: (ii)(iii)</p><p>Property: 14.88 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [-91.4357, 14.3819]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': "<h2>Medieval Jewish heritage of Erfurt</h2> <p>Significance: cultural properties</p> <p>Country: Germany</p><p>Criterion: (iv)</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [11.14524, 50.584319]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': "<h2>Cultural landscape of ancient tea forests of Jingmai Mountain in Pu'er</h2> <p>Significance: cultural properties</p> <p>Country: China</p><p>Criterion: (iii)(v)</p><p>Property: 7,167.89 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [100.027, 22.113]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': "<h2>Silk Roads: Zeravshan-Karakoum corridor</h2> <p>Significance: cultural properties</p> <p>Country: Uzbekistan</p><p>Criterion: (ii)(iii)(v)</p><p>Property: 669.679 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [69.41801, 39.262936]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Cultural',
                'description': "<h2>Tr’ondëk–Klondike</h2> <p>Significance: cultural properties</p> <p>Country: Canada</p><p>Criterion: (iv)</p><p>Property: 334.54 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [-139.262381, 64.3125]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>Odzala-Kokoua Forest Massif</h2> <p>Significance: natural properties</p> <p>Country: Congo</p><p>Criterion: (ix)(x)</p><p>Property: 1,179,376 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [14.5137, 1.208]
            }//
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>Volcanoes and forests of Montagne Pelée and the peaks of northern Martinique</h2> <p>Significance: natural properties</p> <p>Country: France (Martinique)</p><p>Criterion: (viii)(x)</p><p>Property: 13,980 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [-61.10331, 14.492389]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>Anticosti</h2> <p>Significance: natural properties</p> <p>Country: Canada</p><p>Criterion: (viii)</p><p>Property: 18,240 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [-63.1443, 49.3219]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>Cold Winter Deserts of Turan</h2> <p>Significance: natural properties</p> <p>Country: Kazakhstan, Turkménistan</p><p>Criterion: (ix)(x)</p><p>Property: 3,366,441 ha</p><p>Property: 3,366,441 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [79.23, 44.133]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>Tugay forests of the Tigrovaya Balka Nature Reserve</h2> <p>Significance: natural properties</p> <p>Country: Tajikistan</p><p>Criterion: (ix)</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [68.2029, 37.1217]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>Tugay forests of the Tigrovaya Balka Nature Reserve</h2> <p>Significance: natural properties</p> <p>Country: Tajikistan</p><p>Criterion: (ix)</p><p>Property: 49,786 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [68.2029, 37.1217]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>Karst and evaporite caves of the Northern Apennines</h2> <p>Significance: natural properties</p> <p>Country: Italy</p><p>Criterion: (viii)</p><p>Property: 3,680 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [10.23201, 44.22478]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>Nyungwe National Park</h2> <p>Significance: natural properties</p> <p>Country: Rwanda</p><p>Criterion: (x)</p><p>Property: 101,963.67 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [29.14504, -2.331908]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>'Uruq Bani Ma'arid</h2> <p>Significance: natural properties</p> <p>Country: Saudi Arabia</p><p>Criterion: (vii)(ix)</p><p>Property: 1,276,500 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [45.3554, 19.2150]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Natural',
                'description': "<h2>Bale Mountains National Park</h2> <p>Significance: natural properties</p> <p>Country: Ethiopia</p><p>Criterion: (vii)(x)</p><p>Property: 215,000 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [39.4456, 6.4752]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Boundary Changes (Cultural)',
                'description': "<h2>Koutammakou, the land of the Batammariba</h2><p> Significance: cultural properties</p> <p>Country: Benin</p><p>Criterion: (v)(vi)</p><p>Property: 271,826 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [-1.608, 10.8531]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Boundary Changes (Cultural)',
                'description': "<h2>Historic center of Guimarães and Couros area</h2><p> Significance: cultural properties</p> <p>Country: Portugal</p><p>Criterion: (ii)(iii)(iv)</p><p>Property: 38.2 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [-8.1734, 41.26348]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Boundary Changes (Natural)',
                'description': "<h2>Ha Long Bay – Cat Ba archipelago</h2><p> Significance: natural properties</p> <p>Country: Vietnam</p><p>Criterion: (vii)(viii)</p><p>Property: 65,650 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [107.940, 20.4958]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Boundary Changes (Natural)',
                'description': "<h2>Hyrcanian forests</h2><p> Significance: natural properties</p> <p>Country: Azerbaijan</p><p>Criterion: (ix)</p><p>Property: 145,004.74 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [55.43274, 37.25173]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                'icon': 'Boundary Changes (Natural)',
                'description': "<h2>The dry forests of Andrefana</h2><p> Significance: natural properties</p> <p>Country: Madagascar</p><p>Criterion: (vii)(ix)(x)</p><p>Property: 734,298 ha</p>"
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [44.46259, -18.394168]
            }
        },
    ]
};


const filterGroup = document.getElementById("filter-group");
const map = new maplibregl.Map({
    container: "map",
    style:
        'https://api.maptiler.com/maps/satellite/style.json?key=42hWlNIdOqEy0E4oMcxo#1/0/0',
    center: [-5.07532, 22.02233],
    zoom: 2
});


map.on('load', () => {
    // Add a GeoJSON source containing place coordinates and information.
    map.addSource('places', {
        'type': 'geojson',
        'data': places
    });

    places.features.forEach((feature) => {
        const symbol = feature.properties['icon'];
        const layerID = `poi-${symbol}`;

        // Add a layer for this symbol type if it hasn't been added already.
        if (!map.getLayer(layerID)) {
            map.addLayer({
                'id': layerID,
                'type': 'circle',
                'source': 'places',
                'paint': {
                    'circle-radius': 8,
                    'circle-color': '#FFFFFF',
                    'circle-stroke-width': 1,
                    'circle-stroke-color': '#3386c0',
                },
                'filter': ['==', 'icon', symbol]
            });
           let popup;
           
            map.on('mouseenter', layerID, (e) => {
                map.getCanvas().style.cursor = 'pointer';

                const coordinates = e.features[0].geometry.coordinates.slice();
                const description = e.features[0].properties.description;

                if (!popup) {
                    popup = new maplibregl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    }).setLngLat(coordinates)
                      .setHTML(description)
                      .addTo(map);
                } else {
                    popup.setLngLat(coordinates)
                         .setHTML(description);
                }
            });

            map.on('mouseleave', layerID, () => {
                map.getCanvas().style.cursor = '';
                if (popup) {
                    popup.remove(); 
                    popup = undefined; 
                }
            });

            
            // Add checkbox and label elements for the layer.
            const input = document.createElement('input');
            input.type = 'checkbox';
            input.id = layerID;
            input.checked = true;
            filterGroup.appendChild(input);

            const label = document.createElement('label');
            label.setAttribute('for', layerID);
            label.textContent = symbol;
            filterGroup.appendChild(label);
            //
            
            input.addEventListener('change', (e) => {
                map.setLayoutProperty(
                    layerID,
                    'visibility',
                    e.target.checked ? 'visible' : 'none'
                );
            });
        }
    });

});

// Three.js functionality
const threeContainer = document.querySelector('.three-container');

// Create Three.js scene, camera, and renderer
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById("three-canvas") });
renderer.setSize(window.innerWidth, window.innerHeight); // Make sure the size matches the container
renderer.setClearColor(0xffffff);
// Retrieve the container element for Three.js scene




function resizeRenderer() {
    const { clientWidth, clientHeight } = threeContainer;
    renderer.setSize(clientWidth, clientHeight);
    // Update camera aspect ratio on resize
    camera.aspect = clientWidth / clientHeight;
    camera.updateProjectionMatrix();
}

// Call resizeRenderer when the window is resized
window.addEventListener("resize", resizeRenderer);

// Initial call to set up renderer size
resizeRenderer();
//Creates grids and axes in the scene



//geometry
const geometry = new THREE.OctahedronGeometry(2, 2);
const geometry2 = new THREE.TorusKnotGeometry(1.2, 0.633, 60, 13, 2, 3)
const geometries = [geometry, geometry2];


const darkredMaterial = new THREE.MeshLambertMaterial({ color: 0xFF7298, wireframe: true });
const blueMaterial = new THREE.MeshToonMaterial({ color: 0x4F5936, wireframe: true  });
const redMaterial = new THREE.MeshToonMaterial({ color: 0x00ff00 });
const greenMaterial = new THREE.MeshToonMaterial({ color: 0x4056F4, wireframe: true  });
const testbgreenMaterial = new THREE.MeshLambertMaterial({ color: 0x8D5B6C, wireframe: true})

const darkredCube = new THREE.Mesh(geometry, darkredMaterial);
const blueCube = new THREE.Mesh(geometry, blueMaterial);
const redCube = new THREE.Mesh(geometry, redMaterial);
const greenCube = new THREE.Mesh(geometry, greenMaterial);
const testbgreentorusknot = new THREE.Mesh(geometry2, testbgreenMaterial);

darkredCube.position.z = -3;
blueCube.position.x = -3;
redCube.position.x = 3;
greenCube.position.z = 3;

//scene.add(darkredCube);
//scene.add(blueCube);
//scene.add(redCube);
//scene.add(greenCube);
//scene.add(testbgreentorusknot);

const meshes = []; 

const count = 65; 

for (let i = 0; i < count; i++) {
    const randomIndex = Math.floor(Math.random() * 2); 
    const randomGeometry = randomIndex === 0 ? geometry : geometry2; 
  
    let material; 
  

    function getRandomColor() {
        return new THREE.Color(Math.random(), Math.random(), Math.random());
      }
   
    switch (randomIndex) {
      case 0:
        material = blueMaterial;
        break;
      case 1:
        material = darkredMaterial;
        break;
      case 2:
         material = bgreenMaterial;
         break;
      
      default:
        material = new THREE.MeshStandardMaterial({ 
          color: 0xffffff,
          metalness: params.metalness,
          roughness: params.roughness,
        });
        break;
    }
  
    const mesh = new THREE.Mesh(randomGeometry, material);
  

    mesh.position.x = Math.random() * 30 - 0; 
    mesh.position.y = Math.random() * 20 - 4; 
    mesh.position.z = Math.random() * 20 - 20; 
  
    mesh.rotation.x = Math.random() * Math.PI * 2; 
    mesh.rotation.y = Math.random() * Math.PI * 2; 
    mesh.rotation.z = Math.random() * Math.PI * 2; 
  
    scene.add(mesh);
    meshes.push(mesh); 
  }

meshes.forEach((mesh) => {
    mesh.scale.set(0.5, 0.5, 0.5); 
  });

  testbgreentorusknot.scale.set(0.7, 0.7, 0.7);

const gltfLoader = new THREE.GLTFLoader();

let mesh;

gltfLoader.load(
  "./three/models/mini mel bl.glb",
  function (gltf) {
    mesh = gltf.scene;
    mesh.scale.x = 0.5;
    mesh.scale.y = 0.5;
    mesh.scale.z = 0.5;

    mesh.position.set(18,3,4)
    scene.add(mesh);
  },
  undefined,
  function (error) {
    console.error(error);
  }
);

gltfLoader.load(
    "./three/models/mini me bl.glb",
    function (gltf) {
      mesh = gltf.scene;
      mesh.scale.x = 0.5;
      mesh.scale.y = 0.5;
      mesh.scale.z = 0.5;
  
      mesh.position.set(0,0,0)
      scene.add(mesh);
    },
    undefined,
    function (error) {
      console.error(error);
    }
  );

const fontLoader = new THREE.FontLoader();

function createText(text, elevation = 0, textColor = "0x000000", size = 0.5) {
  const textValue = text;
  const textSize = size;
  fontLoader.load("./fonts/helvetiker_regular.typeface.json", function (font) {
    const textGeo = new THREE.TextGeometry(textValue, {
      font: font,
      size: textSize,
      height: 0.1,
      curveSegments: 4,
      bevelEnabled: true,
      bevelThickness: 0.1,
      bevelSize: 0.0,
      bevelOffset: 0,
      bevelSegments: 5,
    });

    const color = new THREE.Color();
    color.setHex(textColor);
    const textMaterial = new THREE.MeshLambertMaterial({ color: color });
    const text = new THREE.Mesh(textGeo, textMaterial);

    text.position.x = 2;
    text.position.y = elevation;

    scene.add(text);
  });
}

createText("Mikhala Gibson", 5, "0X2eab3b");
createText("- M.Arch student at Carleton University", 3, "0X4287f5");
createText("- Bachelor in History and Theory of Architecture", 2, "0X4287f5");
createText("- I am currently learning how to make knitwear", 1, "0X4287f5");
createText("- I made this model of Melanie -> ", 0, "0X4287f5");

camera.position.z = 18;
camera.position.x = 0;
camera.position.y = 0;

scene.position.x = -10;
scene.position.z = 5;
scene.position.y = -3;

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

//Creates the lights of the scene
const lightColor = 0xffffff;

const hemiLight = new THREE.HemisphereLight(lightColor, 0.5);
hemiLight.position.set( 0, 20, 0 );
scene.add(hemiLight);

const directionalLight = new THREE.DirectionalLight(lightColor, 1);
directionalLight.position.set(-3, 10, -10);
directionalLight.target.position.set(0, 3, 0);
directionalLight.castShadow = true;
directionalLight.shadow.camera.top = 2;
directionalLight.shadow.camera.bottom = - 2;
directionalLight.shadow.camera.left = - 2;
directionalLight.shadow.camera.right = 2;
directionalLight.shadow.camera.near = 0.1;
directionalLight.shadow.camera.far = 40;

scene.add(directionalLight);
scene.add(directionalLight.target);

function animate() {
    requestAnimationFrame(animate);
  
    meshes.forEach((mesh) => {
      mesh.rotation.x += 0.008 * Math.random(); 
      mesh.rotation.y += 0.008 * Math.random();
      mesh.rotation.z += 0.008 * Math.random();
    });
  
    renderer.render(scene, camera);
  }
  
  animate();

animate();

window.addEventListener("resize", () => {
    const { clientWidth, clientHeight } = threeContainer;
    renderer.setSize(clientWidth, clientHeight);
    camera.aspect = clientWidth / clientHeight;
    camera.updateProjectionMatrix();
});

document.addEventListener('DOMContentLoaded', function () {
    const mapContainer = document.querySelector('.map-container');
    const threeContainer = document.querySelector('.three-container');
  
    mapContainer.addEventListener('mouseover', function () {
      // Logic for map hover interaction
    });
  
    threeContainer.addEventListener('mouseover', function () {
      // Logic for Three.js scene hover interaction
    });
  
    // Any other combined interactions or functionality between the map and Three.js
  });

  